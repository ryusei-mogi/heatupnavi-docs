# 画面設計書（MVP）

対象：HeatupNavi（iOS 17+ / SwiftUI）

目的：見た目と操作の完成形を揃え、実装とレビューの認識ズレを減らす。

---

## 1. 画面一覧

| No | 画面名 | 役割 | 実体 |
| --- | --- | --- | --- |
| 1 | 初回セットアップ | 自宅位置の登録、通知許可、完了導線 | `HeatupNavi/UI/Views/SetupView.swift` |
| 2 | ホーム（最安設定） | 今日のおすすめ時間帯、節約額、状態表示、導線 | `HeatupNavi/UI/Views/HomeView.swift` |
| 3 | 使用湯量入力 | 前日（※表示上は対象日）の40℃相当使用湯量を入力 | `HeatupNavi/UI/Views/UsageInputView.swift` |
| 4 | 設定 | 通知オン/オフ、昼夜単価、自宅再登録 | `HeatupNavi/UI/Views/SettingsView.swift` |

---

## 2. 画面遷移

### 2.1 起動時

* 自宅位置が未登録 → **初回セットアップ**（No.1）
* 自宅位置が登録済み → **ホーム**（No.2）

### 2.2 画面内導線

* ホーム → 使用湯量入力（No.3）
* ホーム → 設定（No.4）
* 設定/使用湯量入力 → 戻る（NavigationStackの戻る）

### 2.3 通知タップ

* ローカル通知をタップ → **ホーム**（No.2）へ直行
  * 画面を先に表示し、必要ならローディング→天気取得→再計算→表示更新

---

## 3. 共通仕様

### 3.1 ローディング表示

* 基本方針：ユーザー操作に対して「処理中」を見せ、二重タップなどを防ぐ
* ホーム：画面全体に `ProgressView` をオーバーレイ表示
* セットアップ/設定/入力：ボタンを非活性化し、必要ならエラーメッセージで結果を返す

### 3.2 エラー表示

* 画面内に赤文字で表示（Alertではなく、本文内のエラー領域に集約）
* 例（既存メッセージ）
  * 位置情報：`位置情報の許可が必要です。` / `位置情報を取得できませんでした。`
  * 天気：`天気を取得できませんでした。`
  * 通知：`通知が許可されていません。`
  * 入力：`数値を入力してください。`

### 3.3 文言と表記

* 金額：通貨記号 `¥`、小数は表示しない（`¥1,234`）
* 日時：短い日付＋時刻（例：`2025/12/20 7:05`）
* 時刻帯：`H:MM–H:MM`（例：`0:00–5:00`）

---

## 4. 画面別仕様

## 4.1 初回セットアップ（No.1）

### 目的

* 初回起動時に必要な許可・登録（自宅位置、通知）を完了し、ホームへ進める

### 表示項目

* タイトル：`初回セットアップ`
* ステップ表示
  1. `1. 位置情報を取得`
     * 説明：`自宅の地域の天気を取得するために使います。`
  2. `2. 通知を許可`
     * 説明：`毎朝7:00にリマインドを出します。`
* エラー表示（赤）
* フッターボタン：`完了`

### ボタン・入力

* 位置取得ボタン
  * 表示：未完了 `現在地を取得` / 完了後 `位置情報は保存済み`
  * 押下：位置許可→現在地を1回取得→自宅座標として保存
* 通知許可ボタン
  * 表示：未完了 `通知を許可` / 完了後 `通知は許可済み`
  * 押下：通知許可→毎朝7:00のリマインドを先の7日分予約→通知ONを保存
* 完了ボタン
  * 押下：ホームへ遷移（セットアップ状態の再判定を行う）

### 活性/非活性条件

* 位置取得ボタン：`位置情報は保存済み` の場合は非活性
* 通知許可ボタン：`通知は許可済み` の場合は非活性
* 完了ボタン：**位置保存済み かつ 通知許可済み** のときのみ活性
* 共通：処理中（位置取得/通知許可の実行中）は各ボタンを非活性

### エラー表示（例）

* 位置許可を拒否：`位置情報の許可が必要です。`
* 現在地取得失敗：`位置情報を取得できませんでした。`
* 通知許可を拒否：`通知が許可されていません。`

---

## 4.2 ホーム（最安設定）（No.2）

### 目的

* 今日のおすすめ沸き上げ時間帯（最大3枠）と、推定節約額（必要条件が揃う場合）を提示する
* 天気・使用湯量など「計算に使うデータ状態」を見せ、次の行動（入力/設定）へ誘導する

### 表示項目

* ヘッダ
  * 見出し：`今日のおすすめ`
  * 右上ボタン：`更新`（再計算）
* おすすめ時間帯（大きく表示）
  * 値あり：`0:00–5:00 + 13:00–16:00 + 21:00–22:00`
  * 値なし：`—`
* 警告（必要量クリップ時）
  * `必要量が多いため、1日分すべてを使う計算になっています。`（橙/脚注）
* セクション：`推定節約額`
  * 節約額が表示できる条件を満たすとき
    * `今日: ¥X`
    * `月: ¥X / 年: ¥X`（補助文字色）
  * 条件不足のとき
    * `算出に必要な入力が不足しています`（補助文字色）
* セクション：`データ状態`
  * `天気: <更新日時 or 未取得>`
  * `使用湯量: <状態>`
    * 前日入力あり：`NN L（前日分）`
    * 直近値で代用：`NN L（前回入力を使用）`
    * 未入力：`未入力（標準量で計算）`
* エラー表示（赤）
* 導線
  * `前日の使用湯量を入力`（使用湯量入力へ）
  * `設定`（設定へ）

### ボタン・入力

* `更新`：押下でローディング→天気（キャッシュ優先）→再計算→表示更新
* `前日の使用湯量を入力`：使用湯量入力へ遷移
* `設定`：設定へ遷移

### 活性/非活性条件

* `更新`：常に活性（処理中は多重起動を避けるため連打は無効化してもよい）
* ローディング中：画面全体に `ProgressView` を表示し、操作を抑止する

### エラー表示（例）

* 自宅位置未登録：`自宅の位置が未登録です。`
* 電気単価が取得できない：`電気単価の設定が必要です。`
* 計算失敗：`計算に失敗しました。`
* WeatherKit取得失敗（キャッシュも無い）：`天気を取得できませんでした。`

---

## 4.3 使用湯量入力（No.3）

### 目的

* 前日分の 40℃相当使用湯量（L）を入力し、節約額算出を可能にする

### 表示項目

* ナビゲーションタイトル：`使用湯量入力`
* セクション見出し：`前日の使用湯量`
* 対象日：`対象日: YYYY年M月D日`
* 入力欄：`40℃相当 L`
* 保存結果
  * 成功：`保存しました`（緑）
  * 失敗：エラーメッセージ（赤）
* ボタン：`保存`

### 入力仕様

* キーボード：数値（decimal pad）
* バリデーション
  * 数値として解釈できない → `数値を入力してください。`
  * 0未満 → `数値を入力してください。`（MVPでは同一文言）

### 活性/非活性条件

* `保存`：保存処理中は非活性

---

## 4.4 設定（No.4）

### 目的

* 通知のオン/オフ、昼夜の電気単価設定、自宅位置の再登録を行う

### 表示項目

* ナビゲーションタイトル：`設定`
* セクション：`通知`
  * トグル：`毎朝7:00に通知`
  * 警告（必要時）：`通知が許可されていません`（橙）
* セクション：`電気単価（円/kWh）`
  * `夜 開始`（時刻）
  * `夜 終了`（時刻）
  * `夜単価`（数値）
  * `昼 開始`（時刻）
  * `昼 終了`（時刻）
  * `昼単価`（数値）
  * ボタン：`保存`
* セクション：`自宅位置`
  * ボタン：`自宅を再登録`
* エラー表示（赤）

### ボタン・入力

* 通知トグル
  * ON：通知許可→先の7日分を予約→アプリ内設定をON
  * OFF：予約削除（pending+delivered）→アプリ内設定をOFF
* 電気単価入力
  * DatePicker：時分のみ
  * TextField：数値（decimal pad）
  * `保存`：入力値を永続化（保存後も画面に反映）
* 自宅再登録
  * 位置許可→現在地を1回取得→既存の自宅座標を置換

### 活性/非活性条件

* `保存`：保存処理中は非活性
* `自宅を再登録`：処理中は非活性
* 通知ON：許可が得られない場合はトグルをOFFに戻し、警告を表示

### エラー表示（例）

* 通知許可が拒否：`通知が許可されていません。`
* 位置許可が拒否：`位置情報の許可が必要です。`

---

## 5. 未決・検討（画面設計としてのメモ）

* 位置情報が拒否された場合でもアプリが使える導線（市区町村入力・前回値利用など）の追加
* 通知権限がOS設定でOFFの場合の「設定アプリを開く」導線（ボタン）を追加するか
* 「天気更新中 / 更新済み」の明示表示（現在はローディングと日時で表現）

