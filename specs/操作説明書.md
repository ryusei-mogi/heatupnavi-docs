# 操作説明書（HeatupNavi / 沸き上げナビ）

対象：アプリ利用者（iOS 17.0+）

HeatupNavi は、電気単価（昼/夜）と外気温（WeatherKit）を使って、**その日に一番安い「沸き上げ時間帯」**を提案し、**推定の節約額**も表示するアプリです。

> 注意：本アプリの結果は入力値と簡易モデルに基づく概算です。実際の機器・使用状況により差が出ます。

---

## 1. できること

- 今日のおすすめ沸き上げ時間帯（最大3枠）を表示
- 「昼/夜どっちが得？」（実質単価の比較）を表示
- 推定節約額（今日 / 月 / 年）を表示
- 前日の使用湯量（40℃相当 L）の入力
- 通知（毎朝7:00のリマインド）をオン/オフ
- 履歴（過去の日の推定節約額・時間帯）を一覧表示

---

## 2. 初回セットアップ（最初に1回）

初回起動時は「初回セットアップ」画面が表示されます。

### 2.1 位置情報を取得（必須）

1. `現在地を取得` を押します  
2. 位置情報の許可ダイアログが出たら、**「アプリの使用中のみ許可」**で問題ありません  
3. 取得できると「位置情報は保存済み」になります

この位置（自宅の目安）を使って、WeatherKit から外気温を取得します。

### 2.2 通知を許可（任意）

- `通知を許可` を押すと、毎朝7:00の通知（先の7日分）を予約します
- 拒否してもアプリは使えます（後から「設定」画面で変更できます）

### 2.3 完了

`完了` は **位置情報が保存できたら** 押せます。

---

## 3. 毎日の使い方（ホーム）

ホームには4つのカードがあり、タップすると詳細が見られます。

### 3.1 おすすめ時間帯

- 今日の「最安」になる沸き上げ時間帯を、最大3枠で表示します
- `更新` を押すと、天気（キャッシュ優先）を読み直して再計算します

### 3.2 昼/夜どっちが得？

- 昼側最安 / 夜側最安の比較を表示します
- 指標は **実質単価 = 電気単価 ÷ 効率（COP）** です

### 3.3 推定節約額

- **基準運用**（夜間枠を優先して必要分を満たす）と、提案（最安）を比較して節約額を出します
- 月/年は、直近の計算結果の平均を日数換算した概算です

### 3.4 データ状態

計算に使っているデータ（天気更新時刻、使用湯量の状態）を確認できます。

---

## 4. 前日の使用湯量を入力する

ホームの `前日の使用湯量` から、「使用湯量入力」画面を開けます。

- 入力するのは **前日分の「40℃相当の湯量（L）」** です
- 未入力の場合は、直近の入力値または標準値（400L）で概算し、計算を続行します
- 入力後にホームへ戻り `更新` すると、推定の精度が上がります

---

## 5. 設定

ホームの `設定` から変更できます。

### 5.1 通知（毎朝7:00）

- トグルを ON にすると、アプリを開いたタイミングで **先の7日分**を予約します
- iOS側で通知がオフの場合、アプリ内に警告が出ます（iOS設定で許可してください）

### 5.2 電気単価（昼/夜）

- 針（境界）をドラッグして、夜↔昼の時間帯を決めます（**1時間刻み**）
- 昼/夜それぞれの単価（円/kWh）を入力します
- 入力内容は自動で保存されます

### 5.3 自宅位置

- `自宅を再登録` を押したときだけ、位置情報を再取得します（常時追跡はしません）

---

## 6. 履歴

ホーム右上の `履歴` から、過去の日の推定節約額と時間帯を一覧で見られます。

- 初回表示や「さらに前のデータを読み込む」では、計算に少し時間がかかることがあります

---

## 7. よくある困りごと

### 7.1 位置情報が取れない

- iOSの「設定」→「プライバシーとセキュリティ」→「位置情報サービス」→ HeatupNavi で、許可を見直してください

### 7.2 通知が届かない

- iOSの「設定」→「通知」→ HeatupNavi で通知が許可されているか確認してください
- 通知ON後は、アプリを一度開くと先の7日分が予約されます

### 7.3 天気を取得できない

- 通信環境、WeatherKit の利用設定（開発中は署名/Capability）を確認してください
- 取得に失敗しても、当日のキャッシュがあればそれを使って計算を続行します

---

## 8. 端末内に保存されるデータ（プライバシー）

本アプリは、計算に必要な情報を**端末内（SwiftData）**に保存して利用します（自前サーバーは使いません）。

主な保存内容：
- 自宅位置（緯度/経度）
- 電気単価（昼/夜の時間帯・単価）
- 使用湯量（前日分の入力）
- 日別の計算結果（おすすめ時間帯、推定コスト/節約額）
- 天気（当日スロットの気温のキャッシュ）

